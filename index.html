<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Predictor API</title>
    <style>
      :root {
        color-scheme: light dark;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 2rem auto;
        max-width: 900px;
        line-height: 1.6;
        padding: 0 1rem;
      }

      code {
        background: #f5f5f5;
        padding: 0.25rem 0.4rem;
        border-radius: 4px;
      }

      pre {
        background: #0d1117;
        color: #f0f6fc;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
      }

      .card {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 1.25rem;
        margin: 1rem 0;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        background: #ffffffcc;
      }

      .card h2 {
        margin-top: 0;
      }

      form {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        align-items: end;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }

      input,
      select,
      button {
        width: 100%;
        padding: 0.65rem 0.75rem;
        border-radius: 6px;
        border: 1px solid #cbd5e1;
        font-size: 1rem;
      }

      button {
        background: #2563eb;
        color: white;
        cursor: pointer;
        border: none;
        transition: background 0.2s ease;
      }

      button:hover {
        background: #1e4ed8;
      }

      .result {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        background: #f8fafc;
        white-space: pre-line;
      }

      .error {
        color: #b91c1c;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <h1>Advanced Crypto Trading Predictor</h1>
    <p>
      API FastAPI siap pakai yang menarik data real-time dari Binance publik,
      menghitung indikator (SMA20/50, RSI, ATR), dan mengembalikan rekomendasi
      BUY/SELL lengkap dengan Entry, TP, SL, dan confidence score.
    </p>

    <div class="card">
      <h2>Menjalankan API</h2>
      <p>Pasang dependensi: <code>pip install -r requirements.txt</code>.</p>
      <p>Mulai server: <code>uvicorn server:app --reload --port 8000</code></p>
      <p>Endpoint root: <code>GET /</code> untuk cek status.</p>
    </div>

    <div class="card">
      <h2>Request /predict</h2>
      <p>Kirim simbol kripto Binance (contoh <code>BTCUSDT</code>) dan timeframe.</p>
      <pre><code>POST http://localhost:8000/predict
Content-Type: application/json

{
  "symbol": "BTCUSDT",
  "timeframe": "1h"
}</code></pre>
      <p>
        Timeframe yang didukung: <code>1m</code>, <code>5m</code>, <code>15m</code>,
        <code>1h</code>, <code>4h</code>, <code>1d</code>.
      </p>
    </div>

    <div class="card">
      <h2>Uji cepat dari browser ini</h2>
      <form id="predict-form">
        <div>
          <label for="symbol">Symbol</label>
          <input id="symbol" name="symbol" value="BTCUSDT" required />
        </div>
        <div>
          <label for="timeframe">Timeframe</label>
          <select id="timeframe" name="timeframe">
            <option>1m</option>
            <option>5m</option>
            <option>15m</option>
            <option selected>1h</option>
            <option>4h</option>
            <option>1d</option>
          </select>
        </div>
        <div>
          <button type="submit">Ambil Rekomendasi</button>
        </div>
      </form>
      <div id="result" class="result">Hasil akan muncul di sini.</div>
    </div>

    <div class="card">
      <h2>Contoh JavaScript</h2>
      <p>Cuplikan siap tempel untuk frontend.</p>
      <pre><code id="snippet"></code></pre>
    </div>

    <script>
      const form = document.getElementById("predict-form");
      const resultBox = document.getElementById("result");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const symbol = document.getElementById("symbol").value.trim();
        const timeframe = document.getElementById("timeframe").value;

        resultBox.textContent = "Memuat...";

        try {
          const response = await fetch("http://localhost:8000/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ symbol, timeframe }),
          });

          if (!response.ok) {
            const message = await response.text();
            throw new Error(message || "Gagal memanggil API");
          }

          const data = await response.json();
          resultBox.classList.remove("error");
          resultBox.textContent = [
            `${data.symbol} (${data.timeframe}) - ${data.signal}`,
            `Entry: ${data.entry}`,
            `TP: ${data.take_profit}`,
            `SL: ${data.stop_loss}`,
            `Confidence: ${Math.round(data.confidence * 100)}%`,
            `SMA20: ${data.short_sma}`,
            `SMA50: ${data.long_sma}`,
            `RSI: ${data.rsi}`,
            `ATR: ${data.atr}`,
            `Timestamp: ${data.timestamp}`,
          ].join("\n");
        } catch (error) {
          resultBox.classList.add("error");
          resultBox.textContent = error.message;
        }
      });

    const snippet = String.raw`async function loadPrediction() {
  const response = await fetch('http://localhost:8000/predict', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ symbol: 'BTCUSDT', timeframe: '1h' })
  });

  if (!response.ok) {
    throw new Error(await response.text());
  }

  const data = await response.json();
  console.log('Rekomendasi', data);

  // contoh rendering sederhana
  const box = document.createElement('div');
  box.innerHTML = \`
    <strong>\${data.symbol}</strong> (\${data.timeframe}) - \${data.signal}<br>
    Entry: \${data.entry}<br>
    TP: \${data.take_profit}<br>
    SL: \${data.stop_loss}<br>
    Confidence: \${Math.round(data.confidence * 100)}%
  \`;
  document.body.appendChild(box);
}

loadPrediction().catch(console.error);`;
      document.getElementById("snippet").textContent = snippet;
    </script>
  </body>
</html>
